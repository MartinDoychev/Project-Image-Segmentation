<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="bg">
<head>
    <meta charset="UTF-8" />
    <title>Резултат от сегментацията</title>
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <style>
        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: #f8fafc;
          margin: 0;
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }

        header {
          background: #fff;
          border-bottom: 1px solid #e2e8f0;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        header nav {
          display: flex;
          gap: 12px;
          align-items: center;
          padding: 12px 20px;
          max-width: 1200px;
          margin: 0 auto;
        }

        header a, header button {
          padding: 8px 16px;
          border: 1px solid #cbd5e1;
          background: #fff;
          border-radius: 6px;
          text-decoration: none;
          color: #475569;
          font-weight: 500;
          transition: all 0.2s ease;
        }

        header a:hover, header button:hover {
          background: #f1f5f9;
          border-color: #94a3b8;
        }

        main.container {
          max-width: 1400px;
          margin: 24px auto;
          padding: 0 16px;
          flex: 1;
        }

        h1 {
          color: #1e293b;
          margin-bottom: 24px;
          font-size: 1.8rem;
          font-weight: 600;
        }

        .success-banner {
          background: linear-gradient(135deg, #10b981 0%, #059669 100%);
          color: white;
          padding: 16px 24px;
          border-radius: 8px;
          margin-bottom: 32px;
          box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
        }

        .success-banner h2 {
          margin: 0;
          font-size: 1.1rem;
          font-weight: 500;
        }

        .image-card {
          background: #fff;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.08);
          border: 1px solid #e2e8f0;
        }

        .image-card h3 {
          margin: 0 0 16px 0;
          font-size: 1rem;
          font-weight: 600;
          color: #374151;
          text-align: center;
        }

        .image-card img {
          width: 100%;
          height: auto;
          border-radius: 6px;
          box-shadow: 0 1px 4px rgba(0,0,0,0.1);
          cursor: pointer;
        }

        .statistics-section {
          background: #fff;
          border-radius: 10px;
          padding: 24px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.08);
          border: 1px solid #e2e8f0;
        }

        .statistics-section h2 {
          margin: 0 0 20px 0;
          font-size: 1.4rem;
          font-weight: 600;
          color: #1e293b;
        }

        .btn-primary {
          background: #3b82f6;
          color: white;
          padding: 12px 24px;
          border-radius: 8px;
          text-decoration: none;
          margin-right: 12px;
          display: inline-block;
          font-weight: 500;
          transition: background 0.2s ease;
        }

        .btn-primary:hover {
          background: #2563eb;
        }

        footer {
          text-align: center;
          padding: 20px;
          color: #64748b;
          font-size: 0.9rem;
          border-top: 1px solid #e2e8f0;
          background: #fff;
          margin-top: auto;
        }

        @media (max-width: 1024px) {
          div[style*="display: flex"] .image-card {
            flex: 1 1 45% !important;
          }
        }
        @media (max-width: 768px) {
          div[style*="display: flex"] {
            flex-direction: column !important;
          }
          div[style*="display: flex"] .image-card {
            flex: none !important;
          }
        }
    </style>
</head>
<body>
<header>
    <nav>
        <a th:href="@{/}">Начало</a>
        <a th:href="@{/segment}">Нова сегментация</a>
        <form th:action="@{/logout}" method="post" style="display: inline;">
            <button type="submit">Изход</button>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        </form>
    </nav>
</header>

<main class="container">
    <h1>Резултат от сегментацията</h1>

    <div class="success-banner">
        <h2>Сегментацията завърши успешно</h2>
        <p style="margin: 4px 0 0 0; opacity: 0.9;">Сравнение между различни алгоритми за сегментация</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin: 0 auto 32px;">

        <div class="image-card" style="padding: 12px;">
            <h3 style="font-size: 0.95rem; margin-bottom: 10px;">Оригинално изображение</h3>
            <img th:src="@{${originalPath}}" alt="Оригинално" style="width: 100%; height: 180px; object-fit: cover; border-radius: 6px;" />
            <div style="text-align: center; margin-top: 6px; font-size: 0.8rem; color: #64748b;">
                <span th:text="${width + '×' + height}">194×260</span> пиксела
            </div>
        </div>

        <div class="image-card" style="padding: 12px;">
            <h3 style="font-size: 0.95rem; margin-bottom: 10px;">Сегментация без модел</h3>
            <img th:src="@{${kmeansOverlayPath}}" alt="K-means" style="width: 100%; height: 180px; object-fit: cover; border-radius: 6px;" />
            <div style="text-align: center; margin-top: 6px;">
                <div style="font-size: 0.9rem; color: #64748b; font-weight: 500;">Традиционен подход</div>
                <div style="font-weight: 600; color: #1e293b;" th:text="${kmeansSegments + ' сегмента'}">4 сегмента</div>
                <div style="font-size: 0.85rem; color: #1e293b;" th:text="${kmeansAreaPercent + '% покритие'}">30.71% покритие</div>
            </div>
        </div>

        <div class="image-card" style="padding: 12px;">
            <h3 style="font-size: 0.95rem; margin-bottom: 10px;">Сегментация с модел</h3>
            <img th:src="@{${grabCutOverlayPath}}" alt="GrabCut" style="width: 100%; height: 180px; object-fit: cover; border-radius: 6px;" />
            <div style="text-align: center; margin-top: 6px;">
                <div style="font-size: 0.9rem; color: #64748b; font-weight: 500;">ML подход</div>
                <div style="font-weight: 600; color: #1e293b;">1 обект</div>
                <div style="font-size: 0.85rem; color: #1e293b;" th:text="${grabCutAreaPercent + '% покритие'}">45.20% покритие</div>
            </div>
        </div>

    </div>

    <div class="statistics-section">
        <h2>Сравнение на алгоритмите</h2>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
                <thead>
                <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">Алгоритъм</th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #374151;">Тип</th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #374151;">Сегменти</th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #374151;">Покритие</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">Характеристики</th>
                </tr>
                </thead>
                <tbody>
                <tr style="border-bottom: 1px solid #f1f5f9;">
                    <td style="padding: 12px; font-weight: 500;">K-means</td>
                    <td style="padding: 12px; text-align: center; color: #6b7280;">Сегментация без модел</td>
                    <td style="padding: 12px; text-align: center;" th:text="${kmeansSegments}">5</td>
                    <td style="padding: 12px; text-align: center; color: #1e293b;" th:text="${kmeansAreaPercent + '%'}">56.10%</td>
                    <td style="padding: 12px; font-size: 0.9rem; color: #64748b;">Традиционен подход - цветова сегментация, множество региони</td>
                </tr>
                <tr>
                    <td style="padding: 12px; font-weight: 500;">GrabCut</td>
                    <td style="padding: 12px; text-align: center; color: #6b7280;">Сегментация с обучен модел</td>
                    <td style="padding: 12px; text-align: center;">1</td>
                    <td style="padding: 12px; text-align: center; color: #1e293b;" th:text="${grabCutAreaPercent + '%'}">45.20%</td>
                    <td style="padding: 12px; font-size: 0.9rem; color: #64748b;">ML подход - foreground/background разделение</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-top: 20px;">
            <h3 style="margin: 0 0 12px 0; font-size: 1rem; color: #374151;">Анализ на резултатите</h3>
            <ul style="margin: 0; padding-left: 20px; color: #64748b; font-size: 0.9rem; line-height: 1.6;">
                <li><strong>Сегментация без модел</strong> - Традиционен подход с K-means, детектира множество цветови сегменти</li>
                <li><strong>Сегментация с модел</strong> - ML подход с GrabCut, фокусира се на единен основен обект с по-прецизни граници</li>
            </ul>
        </div>

        <div class="actions" style="margin-top: 24px;">
            <a th:href="@{/segment}" class="btn-primary">Тествай с друго изображение</a>
        </div>
    </div>
</main>

<footer>
    <p>&copy; 2025 Image Segmentation Demo</p>
</footer>

<script>
    // Добавяме click-to-zoom за изображенията
    document.querySelectorAll('.image-card img').forEach(img => {
      img.addEventListener('click', function() {
        window.open(this.src, '_blank');
      });
    });
</script>

</body>
</html>